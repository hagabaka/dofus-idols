<!DOCTYPE html>
<html>
  <head>
    <title>Dofus Idol Calculator</title>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/knockout/3.3.0/knockout-min.js'></script>
    <script src="https://code.jquery.com/jquery-1.11.3.min.js"></script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/selectize.js/0.12.1/js/standalone/selectize.min.js'></script>
    <link href='https://cdnjs.cloudflare.com/ajax/libs/selectize.js/0.12.1/css/selectize.min.css' rel='stylesheet' />
    <script src='model.js'></script>

    <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1">
    <style>
      html, body {
        height: 100%;
      }

      #entry {
        width: 50%;
        float: left;
      }
      #display {
        padding-left: 60%;
      }
      .selectize-dropdown [data-selectable] {
        display: inline-block;
        min-width: 15%;
      }

      @media (max-width: 600px) {
        #entry {
          width: 100%;
          float: none;
        }
        #display {
          padding-left: 0;
        }
        #score {
          position: absolute;
          bottom: 0;
        }
        #synergies {
          position: absolute;
          bottom: 2em;
        }
        .selectize-dropdown [data-selectable] {
          display: inline-block;
          min-width: 23%;
        }
        .selectize-dropdown, .selectize-input {
          font-size: x-large;
          line-height: 1em;
        }
        #notes {
          display: none;
        }
      }

      .selectize-dropdown-content {
        max-height: 500px;
      }
      @media (max-height: 400px) {
        .selectize-dropdown-content {
          max-height: 150px;
        }
        #notes {
          display: none;
        }
      }
      @media (min-height: 401px) and (max-height: 600px) {
        .selectize-dropdown-content {
          max-height: 250px;
        }
        #notes {
          display: none;
        }
      }

      #combination-entry {
        width: 100%;
      }

      #score {
        font-size: xx-large;
      }
      #synergies, #synergies ul {
        list-style: none;
        padding-left: 0;
      }
      .idol-name, .idol-names {
        display: inline;
      }
      .idol-name::after {
        content: ' + ';
      }
      .idol-name:last-child::after {
        content: ': ';
      }

      #notes {
        position: absolute;
        bottom: 0;
      }
    </style>
  </head>

  <body>
    <div id='entry'>
      <select id='combination-entry'
        data-bind='foreach: visibleIdols, selectedOptions: combinationEntry' multiple>
        <option data-bind='attr: {value: name}, text: name'></option>
      </select>
    </div>

    <div id='display'>
      <span id='score' data-bind='text: score()'></span>

      <ul id='synergies' data-bind='foreach: synergies()'>
        <li class='synergy'>
          <ul class='idol-names' data-bind='foreach: idols'>
            <li class='idol-name' data-bind='text: name'></li>
          </ul>
          <span class='synergy-value' data-bind='text: value'></span>
        </li>
      </ul>
    </div>

    <div id='notes'>
      <p>This is a calculator for <a href='http://www.dofus.com/'>Dofus</a> idol scores.
      To enter idols in the above box, type and press Enter. Data is mostly from
      <a href='tofus.fr/fiches/idoles.php'>Tofus.fr</a>, and is currently missing for
      most "Major" and below idols.</p>
      <p>I would appreciate feedback and contributions at
        <a href='https://github.com/hagabaka/dofus-idols/issues'>GitHub</a> or
        <a href='http://impsvillage.com/forums/topic/147332-work-in-progress-idol-score-calculator/'>ImpsVillage</a>.
      </p>.
    </div>
    <script src='viewModel.js'></script>
    <script type='text/javascript'>
      Selectize.define('only_close_when_full', function() {
        var self = this;

        this.on('initialize', function() {
          self.open();
        });

        this.close = (function() {
          var originalClose = self.close;
          return function() {
            if(self.isFull()) {
              return originalClose.apply(this, arguments);
            } else {
              return self;
            }
          };
        })();
      });

      var $combinationEntry = $('#combination-entry');
      $combinationEntry.selectize({
        maxItems: 6,
        plugins: ['only_close_when_full', 'remove_button'],
      });
      $combinationEntry.on('dropdown_close', function() {
        $combinationEntry.trigger('dropdown_open');
      });
    </script>
  </body>
</html>
